/**
 * FB Auto - Test Version (Quick Polling)
 * Checks for jobs every 10 seconds for immediate testing
 */

// Copy this ENTIRE line as your bookmark URL:
javascript:(function(){if(window.fbAutoTestRunning){alert('Test already running!');return;}window.fbAutoTestRunning=true;const CONFIG={apiBaseUrl:'https://fbauto-production-4368.up.railway.app/api',authToken:'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJjbWdtMWZtbW0wMDAwcHAwMXFyOWFtMTliIiwiZW1haWwiOiJhc2RAZ21haWwuY29tIiwiaWF0IjoxNzYwMTcyNzkyLCJleHAiOjE3NjA3Nzc1OTJ9.8cMwfH1R2aXSlRYGB_dh34Exqu_nVpPILXSkJ-6s-xY',pollingInterval:10000,debug:true};const log=(message,type='info')=>{const timestamp=new Date().toISOString().substr(11,8);console.log(`🤖 [${timestamp}] FB Auto TEST: ${message}`);updateStatusIndicator(message,type);};const createStatusIndicator=()=>{if(document.getElementById('fb-auto-test'))return;const indicator=document.createElement('div');indicator.id='fb-auto-test';indicator.style.cssText='position:fixed;top:10px;right:10px;background:#FF5722;color:white;padding:12px 16px;border-radius:25px;font-size:14px;z-index:999999;box-shadow:0 4px 12px rgba(0,0,0,0.4);font-family:Arial,sans-serif;font-weight:bold;';indicator.innerHTML='🧪 FB Auto: TEST MODE';document.body.appendChild(indicator);};const updateStatusIndicator=(message,type='info')=>{const indicator=document.getElementById('fb-auto-test');if(!indicator)return;const colors={info:'#2196F3',success:'#4CAF50',warning:'#FF9800',error:'#F44336',test:'#FF5722'};const icons={info:'ℹ️',success:'✅',warning:'⚠️',error:'❌',test:'🧪'};indicator.style.background=colors[type]||colors.test;indicator.innerHTML=`${icons[type]||'🧪'} ${message}`;};const apiCall=async(endpoint)=>{const url=`${CONFIG.apiBaseUrl}${endpoint}`;const headers={'Content-Type':'application/json','Authorization':`Bearer ${CONFIG.authToken}`};try{log(`API Call: ${endpoint}`);const response=await fetch(url,{headers});if(!response.ok){log(`API Error: ${response.status}`,'error');return{jobs:[]};}const data=await response.json();log(`API Success: Found ${data.jobs?.length||0} jobs`,'success');return data;}catch(error){log(`API Failed: ${error.message}`,'error');return{jobs:[]};}};const checkJobs=async()=>{try{updateStatusIndicator('Checking for jobs...','info');const data=await apiCall('/jobs/client-automation');if(data.jobs&&data.jobs.length>0){const totalGroups=data.jobs.reduce((acc,job)=>acc+job.pendingGroups.length,0);updateStatusIndicator(`Found ${data.jobs.length} jobs (${totalGroups} posts)!`,'success');log(`JOBS DETECTED: ${data.jobs.length} jobs with ${totalGroups} total posts`,'success');data.jobs.forEach(job=>{log(`Job: ${job.title} → Groups: [${job.pendingGroups.join(', ')}]`,'info');});}else{updateStatusIndicator('No jobs found','info');log('No pending jobs found');}}catch(error){log(`Check failed: ${error.message}`,'error');updateStatusIndicator('Error checking jobs','error');}};const startTesting=()=>{log('🧪 TEST MODE STARTED - Checking every 10 seconds','test');createStatusIndicator();if(!window.location.hostname.includes('facebook.com')){updateStatusIndicator('Please go to Facebook.com','warning');log('Not on Facebook - please navigate to facebook.com','warning');}checkJobs();const interval=setInterval(()=>{if(!window.fbAutoTestRunning){clearInterval(interval);return;}checkJobs();},CONFIG.pollingInterval);window.addEventListener('beforeunload',()=>{window.fbAutoTestRunning=false;});log('Test monitoring active - watch console for updates','info');};startTesting();})();