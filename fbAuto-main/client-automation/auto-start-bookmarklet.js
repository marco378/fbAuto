/**
 * Auto-Start Facebook Automation
 * 
 * This bookmarklet starts automatically and runs continuously.
 * Just click it once and it will monitor for new jobs forever.
 */

// COPY THIS ENTIRE LINE AS BOOKMARK:
javascript:(function(){if(window.fbAutoRunning){console.log('FB Auto already running');return;}window.fbAutoRunning=true;const CONFIG={apiBaseUrl:'https://fbauto-production-4368.up.railway.app/api',authToken:'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJjbWdtMWZtbW0wMDAwcHAwMXFyOWFtMTliIiwiZW1haWwiOiJhc2RAZ21haWwuY29tIiwiaWF0IjoxNzYwMTcyNzkyLCJleHAiOjE3NjA3Nzc1OTJ9.8cMwfH1R2aXSlRYGB_dh34Exqu_nVpPILXSkJ-6s-xY',pollInterval:15000,autoMode:true};const log=(msg,type='info')=>{const time=new Date().toISOString().substr(11,8);console.log(`ðŸ¤– [${time}] FB Auto: ${msg}`);updateIndicator(msg,type);};const createIndicator=()=>{if(document.getElementById('fb-auto-indicator'))return;const div=document.createElement('div');div.id='fb-auto-indicator';div.style.cssText='position:fixed;top:20px;right:20px;background:#4CAF50;color:white;padding:8px 16px;border-radius:20px;font-size:12px;z-index:999999;box-shadow:0 2px 10px rgba(0,0,0,0.3);font-family:Arial,sans-serif;cursor:pointer;';div.innerHTML='ðŸŸ¢ FB Auto: Starting...';div.onclick=()=>div.style.display='none';document.body.appendChild(div);};const updateIndicator=(msg,type='info')=>{const indicator=document.getElementById('fb-auto-indicator');if(!indicator)return;const colors={info:'#2196F3',success:'#4CAF50',warning:'#FF9800',error:'#F44336'};const icons={info:'ðŸ”„',success:'âœ…',warning:'âš ï¸',error:'âŒ'};indicator.style.background=colors[type]||colors.info;indicator.innerHTML=`${icons[type]||'ðŸ¤–'} ${msg}`;};const sleep=ms=>new Promise(r=>setTimeout(r,ms));const apiCall=async(endpoint,options={})=>{try{const response=await fetch(`${CONFIG.apiBaseUrl}${endpoint}`,{...options,headers:{'Content-Type':'application/json','Authorization':`Bearer ${CONFIG.authToken}`,...options.headers}});if(!response.ok)throw new Error(`HTTP ${response.status}`);return await response.json();}catch(error){log(`API Error: ${error.message}`,'error');return{jobs:[]};}};const findComposer=()=>{const selectors=['[data-testid="status-attachment-mentions-input"]','[role="textbox"][data-testid]','[contenteditable="true"][role="textbox"]','textarea[placeholder*="mind"]'];for(const sel of selectors){const el=document.querySelector(sel);if(el&&el.offsetWidth>0)return el;}return null;};const findPostBtn=()=>{const btns=document.querySelectorAll('[data-testid="react-composer-post-button"],[aria-label="Post"],button');for(const btn of btns){if(btn.textContent.toLowerCase().includes('post')&&btn.offsetWidth>0)return btn;}return null;};const formatPost=job=>`ðŸ”¥ ${job.title}\nðŸ¢ ${job.company}\n\nðŸ“ ${job.location}\nðŸ’¼ ${job.jobType}\n${job.salaryRange?`ðŸ’° ${job.salaryRange}\n`:''}\nðŸ“ ${job.description}\n${job.requirements?.length?`\nâœ… Requirements:\n${job.requirements.map(r=>`â€¢ ${r}`).join('\n')}\n`:''}\nðŸ’¬ Interested? Comment below!\n\n#hiring #jobs #opportunity`;const postJob=async(job,group)=>{try{log(`Posting ${job.title} to ${group}...`);const composer=findComposer();if(!composer){log('Composer not found, trying to open...','warning');const prompts=document.querySelectorAll('[placeholder*="mind"]');for(const p of prompts){if(p.offsetWidth>0){p.click();await sleep(2000);break;}}const newComposer=findComposer();if(!newComposer)throw new Error('Cannot find composer');}const content=formatPost(job);const target=composer||findComposer();target.focus();await sleep(500);if(target.tagName==='TEXTAREA'){target.value=content;target.dispatchEvent(new Event('input',{bubbles:true}));}else{target.innerHTML=content.replace(/\n/g,'<br>');target.dispatchEvent(new Event('input',{bubbles:true}));}await sleep(2000);const postBtn=findPostBtn();if(!postBtn)throw new Error('Post button not found');postBtn.click();await sleep(3000);log(`âœ… Posted to ${group}`,'success');await apiCall(`/jobs/${job.id}/update-posting-status`,{method:'POST',body:JSON.stringify({facebookGroup:group,status:'SUCCESS',postUrl:location.href})});return true;}catch(error){log(`âŒ Failed: ${group} - ${error.message}`,'error');await apiCall(`/jobs/${job.id}/update-posting-status`,{method:'POST',body:JSON.stringify({facebookGroup:group,status:'FAILED',error:error.message})});return false;}};const processJobs=async jobs=>{if(!jobs?.length)return 0;let posted=0;log(`Processing ${jobs.length} jobs...`,'info');for(const job of jobs){for(const group of job.pendingGroups){const success=await postJob(job,group);if(success)posted++;await sleep(10000);}}return posted;};const monitor=async()=>{while(window.fbAutoRunning){try{updateIndicator('Checking for jobs...','info');const data=await apiCall('/jobs/client-automation');if(data.jobs?.length){updateIndicator(`Found ${data.jobs.length} jobs!`,'success');const posted=await processJobs(data.jobs);log(`Completed: ${posted} posts successful`,'success');}else{updateIndicator('Monitoring (no jobs)','info');}await sleep(CONFIG.pollInterval);}catch(error){log(`Monitor error: ${error.message}`,'error');await sleep(30000);}}};const start=()=>{log('Auto-monitoring started! Keep this tab open.','success');createIndicator();if(!location.hostname.includes('facebook.com')){updateIndicator('Please go to Facebook.com','warning');return;}monitor();window.addEventListener('beforeunload',()=>{window.fbAutoRunning=false;});document.addEventListener('visibilitychange',()=>{if(document.hidden){log('Tab hidden - automation paused','warning');}else{log('Tab visible - automation resumed','success');}});};start();})();

// USAGE:
// 1. Copy the javascript: line above and save as bookmark
// 2. Go to Facebook.com and make sure you're logged in  
// 3. Click the bookmark ONCE
// 4. Keep the Facebook tab open
// 5. Create jobs on your Vercel frontend - they'll post automatically!